{"version":3,"sources":["canvas.ts","periodic-table.ts","atom.ts","bond.ts","math.ts","molecule.ts","app.ts"],"names":[],"mappings":"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","file":"app.4899e136.js","sourceRoot":"..","sourcesContent":["export class Canvas {\n  canvas: HTMLCanvasElement;\n  ctx: CanvasRenderingContext2D;\n\n  constructor(id: string) {\n    this.canvas = document.getElementById(id) as HTMLCanvasElement;\n    this.canvas.width = window.innerWidth;\n    this.canvas.height = window.innerHeight;\n\n    this.ctx = this.canvas.getContext('2d');\n  }\n\n  get center(): [number, number] {\n    return [this.canvas.width / 2, this.canvas.height / 2];\n  }\n\n  animate(callback: (dt: number, cancel: () => void) => void) {\n    let lastFrame = performance.now();\n    const fn = () => {\n      const now = performance.now();\n      const dt = now - lastFrame;\n      lastFrame = now;\n      let cancelled = false;\n\n      callback(dt, () => (cancelled = true));\n\n      if (!cancelled) {\n        requestAnimationFrame(fn);\n      }\n    };\n\n    requestAnimationFrame(fn);\n  }\n\n  drawCircle(position: [number, number], radius: number) {\n    this.ctx.fillStyle = 'white';\n    this.ctx.strokeStyle = 'black';\n    this.ctx.lineWidth = 2;\n    this.ctx.beginPath();\n    this.ctx.arc(...position, radius, 0, 2 * Math.PI);\n    this.ctx.fill();\n    this.ctx.stroke();\n  }\n\n  drawText(position: [number, number], text: string) {\n    this.ctx.fillStyle = 'black';\n    this.ctx.font = '20px sans-serif';\n    this.ctx.textAlign = 'center';\n    this.ctx.textBaseline = 'middle';\n    this.ctx.fillText(text, ...position);\n  }\n\n  drawLine(a: [number, number], b: [number, number]) {\n    this.ctx.strokeStyle = 'black';\n    this.ctx.lineWidth = 3;\n    this.ctx.beginPath();\n    this.ctx.moveTo(...a);\n    this.ctx.lineTo(...b);\n    this.ctx.stroke();\n  }\n\n  drawParallelLines(a: [number, number], b: [number, number], n: number = 2) {\n    this.ctx.beginPath();\n    this.ctx.moveTo(...a);\n    this.ctx.lineTo(...b);\n\n    for (let w = 3 * (2 * n - 1), black = true; w > 0; w -= 6, black = !black) {\n      this.ctx.strokeStyle = black ? 'black' : 'white';\n      this.ctx.lineWidth = w;\n      this.ctx.stroke();\n    }\n  }\n}\n","export const elements = [\n  'H',\n  'He',\n  'Li',\n  'Be',\n  'B',\n  'C',\n  'N',\n  'O',\n  'F',\n  'Ne',\n  'Na',\n  'Mg',\n  'Al',\n  'Si',\n  'P',\n  'S',\n  'Cl',\n  'Ar',\n  'K',\n  'Ca',\n];\n\nexport type ElementMap<T> = { [symbol: string]: T };\n\nexport const atomicNumbers: ElementMap<number> = {};\nfor (let i = 0; i < elements.length; i++) {\n  const element = elements[i];\n  atomicNumbers[element] = i + 1;;\n}\n\nexport const shellCapacities = [2, 8, 8, 18, 18];\n\nexport const elementInfo: ElementMap<{\n  period: number;\n  electronConfiguration: number[];\n  valenceElectrons: number;\n  requiredBonds: number;\n}> = {};\nfor (const element of elements) {\n  const atomicNumber = atomicNumbers[element];\n  const electronConfiguration: number[] = [];\n  let shellCapacity: number;\n  let electronsInShell: number;\n  let shell: number;\n  let electronsLeft: number;\n\n  for (\n    shell = 0, electronsLeft = atomicNumber;\n    electronsLeft > 0;\n    shell++\n  ) {\n    shellCapacity = shellCapacities[shell];\n    if (!shellCapacity) {\n      throw new Error(`Element ${element} too big`);\n    }\n    electronsInShell = Math.min(electronsLeft, shellCapacity);\n    electronConfiguration.push(electronsInShell);\n    electronsLeft -= electronsInShell;\n  }\n  const valenceElectrons = electronsInShell;\n\n  const requiredBonds =\n    valenceElectrons > shellCapacity / 2\n      ? shellCapacity - valenceElectrons\n      : valenceElectrons;\n\n  elementInfo[element] = {\n    period: shell + 1,\n    electronConfiguration,\n    valenceElectrons,\n    requiredBonds,\n  };\n}\n","import { Canvas } from \"./canvas\";\nimport { atomicNumbers, elementInfo } from \"./periodic-table\";\n\nexport class Atom {\n  constructor(public symbol: string, public position: [number, number]) {}\n\n  draw(canvas: Canvas) {\n    canvas.drawCircle(this.position, 20)\n    canvas.drawText(this.position, this.symbol);\n  }\n\n  get atomicNumber() {\n    return atomicNumbers[this.symbol];\n  }\n  get requiredBonds() {\n    return elementInfo[this.symbol].requiredBonds;\n  }\n}\n","import { Atom } from \"./atom\";\nimport { Canvas } from \"./canvas\";\n\nexport class Bond {\n  constructor(\n    public atom1: Atom,\n    public atom2: Atom,\n    /**\n     * The number of shared electrons\n     * eg. 2 for a double bond\n     */\n    public count: number\n  ) {}\n\n  draw(canvas: Canvas) {\n    canvas.drawParallelLines(this.atom1.position, this.atom2.position, this.count);\n  }\n}\n","export type Vec = [number, number]\n\nexport function dist(a: Vec, b: Vec): number {\n  const dx = b[0] - a[0];\n  const dy = b[1] - a[1];\n  return Math.sqrt(dx * dx + dy * dy);\n}\n\nexport function rightOf(a: Vec, b: Vec): boolean {\n  const dx = b[0] - a[0];\n  const dy = b[1] - a[1];\n  return dx > 0 && dx > Math.abs(dy);\n}\n\nexport function leftOf(a: Vec, b: Vec): boolean {\n  const dx = b[0] - a[0];\n  const dy = b[1] - a[1];\n  return dx < 0 && -dx > Math.abs(dy);\n}\n\nexport function below(a: Vec, b: Vec): boolean {\n  const dx = b[0] - a[0];\n  const dy = b[1] - a[1];\n  return dy > 0 && dy > Math.abs(dx);\n}\n\nexport function above(a: Vec, b: Vec): boolean {\n  const dx = b[0] - a[0];\n  const dy = b[1] - a[1];\n  return dy < 0 && -dy > Math.abs(dx);\n}\n","import { Atom } from \"./atom\";\nimport { Bond } from \"./bond\";\nimport { Canvas } from \"./canvas\";\nimport { above, below, dist, leftOf, rightOf } from \"./math\";\n\nconst bondLength = 100;\nconst minBondLength = 70;\n\nexport class Molecule {\n  private atoms: Atom[] = [];\n  private bonds: Bond[] = [];\n  private bondMap = new Map<Atom, Bond[]>();\n\n  static fromMolecularFormula(formula: string, center: [number, number]) {\n    const atoms: [string, number][] = Molecule.parseFormula(formula);\n\n    const molecule = new Molecule();\n    for (const [symbol, count] of atoms) {\n      for (let i = 0; i < count; i++) {\n        molecule.addAtom(new Atom(symbol, center));\n      }\n    }\n\n    return molecule;\n  }\n\n  private static parseFormula(formula: string) {\n    const atoms: [string, number][] = [];\n    for (let i = 0; i < formula.length;) {\n      let symbol = formula[i++];\n      let count = '';\n      while (i < formula.length && isLower(formula[i])) {\n        symbol += formula[i++];\n      }\n      while (i < formula.length && isNumeric(formula[i])) {\n        count += formula[i++];\n      }\n\n      atoms.push([symbol, +count || 1]);\n    }\n    return atoms;\n  }\n\n  log() {\n    console.group('ATOMS:');\n    console.table(this.atoms);\n    console.groupEnd();\n\n    console.group('BONDS:');\n    console.table(this.bonds);\n    console.groupEnd();\n  }\n\n  draw(canvas: Canvas) {\n    for (const bond of this.bonds) {\n      bond.draw(canvas);\n    }\n    for (const atom of this.atoms) {\n      atom.draw(canvas);\n    }\n  }\n\n  addAtom(atom: Atom) {\n    this.atoms.push(atom);\n    this.bondMap.set(atom, []);\n  }\n\n  bond(atom1: Atom, atom2: Atom, count: number = 1) {\n    const existingBond = this.findBond(atom1, atom2);\n    if (existingBond) {\n      existingBond.count += count;\n      return;\n    }\n\n    if (dist(atom1.position, atom2.position) < minBondLength) {\n      atom2.position = this.getNextBondingPosition(atom1);\n    }\n\n    const bond = new Bond(atom1, atom2, count);\n    this.bonds.push(bond);\n\n    this.bondMap.get(atom1).push(bond);\n    this.bondMap.get(atom2).push(bond);\n  }\n\n  findBond(atom1: Atom, atom2: Atom) {\n    const bondList = this.bondMap.get(atom1);\n    return bondList.find(\n      (bond) => bond.atom1 === atom2 || bond.atom2 === atom2\n    );\n  }\n\n  getNextBondingPosition(atom: Atom): [number, number] {\n    const bonds = this.bondMap.get(atom);\n    const bondedTo: Atom[] = [];\n    for (const bond of bonds) {\n      if (bond.atom1 !== atom) {\n        bondedTo.push(bond.atom1);\n      }\n      if (bond.atom2 !== atom) {\n        bondedTo.push(bond.atom2);\n      }\n    }\n\n    const [x, y] = atom.position;\n    if (!bondedTo.some((a) => rightOf(atom.position, a.position)))\n      return [x + bondLength, y];\n    if (!bondedTo.some((a) => leftOf(atom.position, a.position)))\n      return [x - bondLength, y];\n    if (!bondedTo.some((a) => below(atom.position, a.position)))\n      return [x, y + bondLength];\n    if (!bondedTo.some((a) => above(atom.position, a.position)))\n      return [x, y - bondLength];\n    throw new Error('Trying to over-bond atom');\n  }\n\n  autoBond() {\n    // DESC atomic number\n    this.atoms.sort((a, b) => b.atomicNumber - a.atomicNumber);\n    // DESC required bonds\n    this.atoms.sort((a, b) => b.requiredBonds - a.requiredBonds);\n\n    const centerAtom = this.atoms[0];\n    const otherAtoms = this.atoms.slice(1);\n    for (const atom of otherAtoms) {\n      this.bond(centerAtom, atom);\n    }\n\n    for (let i = 0; !this.hasRequiredBonds; i++) {\n      if (i > 100) {\n        throw new Error('Auto bonding taking too long');\n      }\n\n      for (const atom of otherAtoms) {\n        if (atom.requiredBonds > this.totalBonds(atom)) {\n          this.bond(centerAtom, atom);\n          break;\n        }\n      }\n    }\n  }\n\n  get hasRequiredBonds() {\n    let extraBondsNeeded = 0;\n    for (const atom of this.atoms) {\n      const totalBonds = this.totalBonds(atom);\n      if (totalBonds !== atom.requiredBonds) {\n        if (totalBonds > atom.requiredBonds) {\n          console.warn(`${atom.symbol} atom is over-bonded`);\n        }\n        extraBondsNeeded += atom.requiredBonds - totalBonds;\n      }\n    }\n    return extraBondsNeeded === 0;\n  }\n\n  private totalBonds(atom: Atom) {\n    const bondList = this.bondMap.get(atom);\n    const totalBonds = bondList.reduce((acc, bond) => acc + bond.count, 0);\n    return totalBonds;\n  }\n}\n\nfunction isLower(c: string) {\n  return c === c.toLowerCase() && c !== c.toUpperCase();\n}\n\nfunction isNumeric(c: string) {\n  return '1234567890'.includes(c);\n}\n","import { Atom } from './atom';\nimport { Bond } from './bond';\nimport { Canvas } from './canvas';\nimport { Molecule } from './molecule';\n\nconst canvas = new Canvas('main-canvas');\n\nconst molecule = Molecule.fromMolecularFormula('SO2', canvas.center);\n\ntry {\n  molecule.autoBond();\n} finally {\n  molecule.log();\n  molecule.draw(canvas);\n}\n"]}